(async()=>{let r=await chrome.storage.local.get(null);const D="https://beta.nocaptchaai.com/solve",F={"Content-Type":"application/json",apikey:r.apikey},E=e=>document.querySelector(e);function L(){document.querySelector("#recaptcha-verify-button")?.click()}r.Rfast&&window.addEventListener("load",()=>{const t=document.body.appendChild(document.createElement("style")).sheet;t.insertRule(`.rc-imageselect-table-33, .rc-imageselect-table-42, .rc-imageselect-table-44 {transition-duration: ${1/2}s !important}`,0),t.insertRule(`.rc-imageselect-tile {transition-duration: ${4/2}s !important}`,1),t.insertRule(`.rc-imageselect-dynamic-selected {transition-duration: ${2/2}s !important}`,2),t.insertRule(`.rc-imageselect-progress {transition-duration: ${1/2}s !important}`,3),t.insertRule(`.rc-image-tile-overlay {transition-duration: ${1/2}s !important}`,4),t.insertRule("#rc-imageselect img {pointer-events: none !important}",5)});class s{static time(){return Date.now||(Date.now=()=>new Date().getTime()),Date.now()}static date(){return new Date}static sleep(t=1e3){return new Promise(o=>setTimeout(o,t))}static async random_sleep(t,o){const n=Math.floor(Math.random()*(o-t)+t);return await s.sleep(n)}}async function q(e){if(!e)throw new Error("A valid URL must be provided.");const t=await fetch(e);if(!t.ok)throw new Error(`Failed to fetch URL. Status code: ${t.status}`);const o=await t.blob(),n=new FileReader;return new Promise((h,c)=>{n.onloadend=()=>{n.result?h(n.result.replace(/^data:image\/(png|jpeg);base64,/,"")):c(new Error("Failed to convert to base64"))},n.readAsDataURL(o)})}function P(){return document.querySelector(".recaptcha-checkbox")!==null}function U(){return document.querySelector("#rc-imageselect")!==null}function j(){document.querySelector("#recaptcha-anchor")?.click()}async function I(e){$()||(await s.sleep(500),j())}function O(){return document.querySelector(".rc-doscaptcha-header")!==null}function $(){const e=document.querySelector(".recaptcha-checkbox")?.getAttribute("aria-checked")==="true",t=document.querySelector("#recaptcha-verify-button")?.disabled;return e||t}function A(){const e=[".rc-imageselect-incorrect-response"];for(const t of e)if(document.querySelector(t)?.style.display==="")return!0;return!1}function W(){const e=[".rc-imageselect-error-select-more",".rc-imageselect-error-dynamic-more",".rc-imageselect-error-select-something"];for(const t of e){const o=document.querySelector(t);if(o?.style.display===""||o?.tabIndex===0)return!0}return!1}function J(){r.Rlogs&&console.log("skipping"),E("#recaptcha-reload-button")?.click()}function M(e){try{return e.classList.contains("rc-imageselect-tileselected")}catch{}return!1}function N(e){return e?.src?.trim()}function x(){const e=document.querySelector(".rc-imageselect-desc strong,.rc-imageselect-desc-no-canonical strong")?.innerText;if(e)return e}function R(){return new Promise(async e=>{for(;;){await s.sleep(100);const t=document.querySelectorAll(".rc-imageselect-tile"),o=document.querySelectorAll(".rc-imageselect-dynamic-selected");if(t.length>0&&o.length===0)return e(!0)}})}let C=null;function V(e=1e3){return new Promise(t=>{let o=!1;const n=setInterval(async()=>{if(o)return;o=!0;const h=document.querySelector(".rc-imageselect-instructions")?.innerText?.split(`
`);let c=await x();if(!c){o=!1;return}const u=h.length===3,a=document.querySelectorAll("table tr td");if(a.length!==9&&a.length!==16){o=!1;return}const p=[],l=Array(a.length).fill(null);let y=null,w=!1,v=0;for(const g of a){const _=g?.querySelector("img");if(!_){o=!1;return}const d=N(_);if(!d||d===""){o=!1;return}_.naturalWidth>=300?y=d:_.naturalWidth==100&&(l[v]=d,w=!0),p.push(g),v++}w&&(y=null);const f=JSON.stringify([y,l]);if(C===f){o=!1;return}return C=f,clearInterval(n),o=!1,t({task:c,is_hard:u,cells:p,background_url:y,urls:l})},e)})}async function z(){const e=[...document.querySelectorAll('iframe[src*="/recaptcha/api2/anchor"]'),...document.querySelectorAll('iframe[src*="/recaptcha/enterprise/anchor"]')];if(e.length===0)return!1;for(const t of e)if(window.getComputedStyle(t).visibility==="visible")return await T(!0);return await T(!1)}async function T(e){return e}async function B(){const e=[...document.querySelectorAll('iframe[src*="/recaptcha/api2/bframe"]'),...document.querySelectorAll('iframe[src*="/recaptcha/enterprise/bframe"]')];if(e.length>0){for(const t of e)if(window.getComputedStyle(t).visibility==="visible")return!0;return!1}}async function G(){if(r.Rlogs&&console.log("on_image_frame"),O()){r.Rlogs&&console.log("rate limited");return}if(r.Rlogs&&console.log("not rate limited"),$()||(r.Rlogs&&console.log("not solved"),!k&&A()?(m=[],k=!0):k=!1,r.Rlogs&&console.log("not incorrect"),(W()||A())&&(m=[],J()),r.Rlogs&&console.log("not error"),!await R()))return;r.Rlogs&&console.log("images ready");const{task:t,is_hard:o,cells:n,background_url:h,urls:c}=await V();r.Rlogs&&console.log(t);const u=n.length==9?33:44;let a=[],p,l=[];if(h===null){p="split_33";for(let i=0;i<c.length;i++){const S=c[i],H=n[i];S&&!m.includes(S)&&(a[i]=await q(S),l.push(H))}r.Rlogs&&console.log(a)}else a.push(await q(h)),p=u,l=n,r.Rlogs&&console.log(l);a={...a};const y=s.time(),w=await x();r.Rlogs&&console.log("target",w);const f=await(await fetch(D,{method:"POST",headers:F,body:JSON.stringify({images:a,target:w,type:p,method:"recaptcha2"})})).json();f.error==="Unauthorized"&&(window.alert(f.message),await s.sleep(3e3),window.open("https://dash.noCaptchaAi.com"));const g=f.solution;r.Rlogs&&console.log(g);const d=1500-(s.time()-y);d>0&&await s.sleep(d);let b=g.length;r.Rlogs&&console.log("length",g.length),r.Rlogs&&console.log("clicks",b);for(let i of g)await f.status==="solved"&&!M(l[i])&&(l[i]?.click(),await s.sleep(300));for(const i of c)m.push(i),m.length>9&&m.shift();r.Rlogs&&console.log("n =",u,"is hard",o,"clicks = ",b,"onImageReady",await R()),(u===33&&o&&b===0&&await R()||u===33&&!o||u===44)&&(await s.sleep(200),L(),b=0)}let k=!1,m=[];for(;await s.sleep(1e3),r.Rlogs&&console.log("reCaploop"),!(!r.apikey||r.power===!1||r.reCap===!1);)await B(),await z(),r.RautoOpen&&P()?await I():r.RautoSolve&&U()&&await G()})();
